(self.AMP=self.AMP||[]).push({n:"amp-install-serviceworker",v:"1525461683159",f:(function(AMP){function g(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;for(var d in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,d);e&&Object.defineProperty(a,d,e)}else a[d]=b[d]}function h(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var l=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function m(a){var b=Object.create(null);if(!a)return b;for(var c;c=l.exec(a);){var d=h(c[1],c[1]),e=c[2]?h(c[2],c[2]):"";b[d]=e}return b};var n="";self.log=self.log||{user:null,dev:null,userForEmbed:null};var p=self.log;function q(){if(!p.user)throw Error("failed to call initLogConstructor");return p.user};function r(a){this.m=a;this.h=Object.create(null)}r.prototype.get=function(a){if(this.h[a])return this.h[a].access=Date.now(),this.h[a].payload};r.prototype.put=function(a,b){var c=this;this.h[a]={payload:b,access:Date.now()};var d=Object.keys(this.h);if(d.length>this.m){if(p.dev)a=p.dev;else throw Error("failed to call initLogConstructor");a.warn("lru-cache","Trimming template cache");d.sort(function(a,b){return c.h[b].access-c.h[a].access});delete this.h[d[d.length-1]]}};var t=self.AMP_CONFIG||{},u=("string"==typeof t.cdnProxyRegex?new RegExp(t.cdnProxyRegex):t.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;var v={c:!0,v:!0,a:!0,ad:!0},w,x,y=/[?&]amp_js[^&]*/,z=/[?&]amp_gsa[^&]*/,A=/[?&]usqp[^&]*/;
function B(a){var b;w||(w=self.document.createElement("a"),x=self.UrlCache||(self.UrlCache=new r(100)));var c=x.get(a);if(c)return c;var d=w;d.href=a;d.protocol||(d.href=d.href);var e={href:d.href,protocol:d.protocol,host:d.host,hostname:d.hostname,port:"0"==d.port?"":d.port,pathname:d.pathname,search:d.search,hash:d.hash,origin:null};"/"!==e.pathname[0]&&(e.pathname="/"+e.pathname);if("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)e.port="",e.host=e.hostname;e.origin=d.origin&&
"null"!=d.origin?d.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href;var f=e,k=f;if(b)return k;x.put(a,k);return k}function C(a){"string"==typeof a&&(a=B(a));var b;(b="https:"==a.protocol||"localhost"==a.hostname)||(a=a.hostname,b=a.length-10,b=0<=b&&a.indexOf(".localhost",b)==b);return b}
function D(a,b){var c;c=void 0===c?"source":c;q().assert(null!=a,"%s %s must be available",b,c);var d=a;q().assert(C(d)||/^(\/\/)/.test(d),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',b,c,d)}function E(a){var b=a.indexOf("#");return-1==b?a:a.substring(0,b)}function F(a){"string"==typeof a&&(a=B(a));return u.test(a.origin)}
function G(a){"string"==typeof a&&(a=B(a));if(!F(a))return a.href;var b=a.pathname.split("/"),c=b[1];q().assert(v[c],"Unknown path prefix in url %s",a.href);var d=b[2],e="s"==d?"https://"+decodeURIComponent(b[3]):"http://"+decodeURIComponent(d);q().assert(0<e.indexOf("."),"Expected a . in origin %s",e);b.splice(1,"s"==d?3:2);b=e+b.join("/");c=(c=a.search)&&"?"!=c?(c=c.replace(y,"").replace(z,"").replace(A,"").replace(/^[?&]/,""))?"?"+c:"":"";return b+c+(a.hash||"")};function H(a,b){a=a.__AMP_TOP||a;return I(a,b)}function L(a,b){a=M(a);a=M(a);a=a.isSingleDoc()?a.win:a;return I(a,b)}function M(a){return a.nodeType?H((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function I(a,b){var c=a.services;c||(c=a.services={});var d=c;a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function N(a,b){for(var c,d=a;d&&d!==c;d=d.parentElement)if(b(d))return d;return null}function O(a){var b="A";if(a.closest)return a.closest(b);b=b.toUpperCase();return N(a,function(a){return a.tagName==b})};var P,Q="Webkit webkit Moz moz ms O o".split(" ");function R(a){var b=void 0;P||(P=Object.create(null));var c=P.display;if(!c||b){c="display";if(void 0===a.display){var d;a:{for(d=0;d<Q.length;d++){var e=Q[d]+"Display";if(void 0!==a[e]){d=e;break a}}d=""}var f=d;void 0!==a[f]&&(c=f)}b||(P.display=c)}return c}function S(a,b){var c,d=R(a.style);d&&(a.style[d]=c?b+c:b)}function T(a){var b=!1;if(void 0===b){var c;c=(c=R(a.style))?a.style[c]:void 0;b="none"==c}S(a,b?"":"none")};var U;function V(a,b){function c(a){try{return f(a)}catch(J){throw self.reportError(J),J;}}var d=void 0,e=a,f=b,k=W(),K=!1;d&&(K=d.capture);e.addEventListener("click",c,k?d:K)}function W(){if(void 0!==U)return U;U=!1;try{var a={get capture(){U=!0}};self.addEventListener("test-options",null,a);self.removeEventListener("test-options",null,a)}catch(b){}return U};function X(a){a=AMP.BaseElement.call(this,a)||this;a.j=null;a.C=null;return a}g(X,AMP.BaseElement);
X.prototype.buildCallback=function(){var a=this,b=this.win;if("serviceWorker"in b.navigator){var c=this.element.getAttribute("src");D(c,this.element);if(F(c)||F(b.location.href)){var d=this.element.getAttribute("data-iframe-src");if(d){D(d,this.element);var b=B(d).origin,e=L(this.element,"documentInfo").get(),f=B(e.sourceUrl),k=B(e.canonicalUrl);q().assert(b==f.origin||b==k.origin,"data-iframe-src (%s) should be a URL on the same origin as the source (%s) or canonical URL (%s) of the AMP-document.",b,
f.origin,k.origin);this.j=d;Y(this)}}else B(b.location.href).origin==B(c).origin?this.loadPromise(this.win).then(function(){return aa(a.win,c)}):this.user().error("amp-install-serviceworker","Did not install ServiceWorker because it does not match the current origin: "+c)}else ba(this)};function Y(a){L(a.getAmpDoc(),"viewer").whenFirstVisible().then(function(){H(a.win,"timer").delay(function(){a.mutateElement(a.w.bind(a))},1E4)})}
X.prototype.w=function(){if(L(this.getAmpDoc(),"viewer").isVisible()){S(this.element,"none");var a=this.win.document.createElement("iframe");a.setAttribute("sandbox","allow-same-origin allow-scripts");a.src=this.j;this.element.appendChild(a)}};
function ba(a){if(a.getAmpDoc().isSingleDoc()){var b=a.getAmpDoc(),c=B(a.win.location.href),d=a.element.getAttribute("data-no-service-worker-fallback-url-match"),e=a.element.getAttribute("data-no-service-worker-fallback-shell-url");if(d||e){q().assert(d&&e,'Both, "%s" and "%s" must be specified for url-rewrite',"data-no-service-worker-fallback-url-match","data-no-service-worker-fallback-shell-url");var e=E(e),f;try{f=new RegExp(d)}catch(k){throw q().createError('Invalid "data-no-service-worker-fallback-url-match" expression',
k);}q().assert(B(G(c)).origin==B(e).origin,'Shell source origin "%s" must be the same as source origin "%s"',e,c.href);a.C=new Z(b,f,e);C(e)&&ca(a,e)}}}function ca(a,b){var c=a.loadPromise(a.win),d=L(a.getAmpDoc(),"viewer").whenFirstVisible();Promise.all([c,d]).then(function(){a.mutateElement(function(){return da(a,b)})})}
function da(a,b){var c=a.win.document.createElement("iframe");c.id="i-amphtml-shell-preload";c.setAttribute("src",b+"#preload");T(c);c.setAttribute("sandbox","allow-scripts allow-same-origin");var d=a.loadPromise(c);d.then(function(){c.parentElement&&c.parentElement.removeChild(c)});a.element.appendChild(c)}function Z(a,b,c){this.win=a.win;this.B=b;this.A=c;this.l=B(c);a=a.getRootNode();b=this.o.bind(this);V(a,b)}
Z.prototype.o=function(a){if(!a.defaultPrevented&&(a=O(a.target))&&a.href){var b=B(a.href);if(b.origin==this.l.origin&&b.pathname!=this.l.pathname&&this.B.test(b.href)&&!a.getAttribute("i-amphtml-orig-href")){var c=this.win;E(b.href)!=E(c.location.href)&&(a.setAttribute("i-amphtml-orig-href",a.href),a.href=this.A+"#href="+encodeURIComponent(""+b.pathname+b.search+b.hash))}}};
function aa(a,b){return a.navigator.serviceWorker.register(b).then(function(a){var b=self;if(b.AMP_MODE)b=b.AMP_MODE;else{var c=m(b.location.originalHash||b.location.hash),f=m(b.location.search);n||(n=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"011525461683159");b=b.AMP_MODE={localDev:!1,development:!("1"!=c.development&&!b.AMP_DEV_MODE),examiner:"2"==c.development,filter:c.filter,geoOverride:c["amp-geo"],minified:!0,lite:void 0!=f.amp_lite,test:!1,log:c.log,version:"1525461683159",
rtvVersion:n}}b.development&&q().info("amp-install-serviceworker","ServiceWorker registration successful with scope: ",a.scope);return a},function(a){q().error("amp-install-serviceworker","ServiceWorker registration failed:",a)})}(function(a){a.registerElement("amp-install-serviceworker",X)})(self.AMP);
})});
//# sourceMappingURL=amp-install-serviceworker-0.1.js.map

